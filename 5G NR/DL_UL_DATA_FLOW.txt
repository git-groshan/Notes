Below is a **clean, end-to-end explanation of Downlink (DL) and Uplink (UL) data flow in 5G NR**, exactly how it happens **layer by layer** (core â†’ RAN â†’ UE and back).
This is **interview-ready** and also useful for **L2/MAC debugging**.

---

# ğŸ“¥ Downlink (DL) Data Flow â€” Network âœ UE

## 1ï¸âƒ£ Core Network â†’ gNB (CU-UP)

* User data comes from **5G Core (UPF)** via **N3 interface**
* Protocol used: **GTP-U**
* Data reaches **gNB CU-UP**

```
UPF â†’ (GTP-U) â†’ gNB CU-UP
```

---

## 2ï¸âƒ£ SDAP (Service Mapping)

* Maps **QoS Flow ID (QFI)** â†’ **Data Radio Bearer (DRB)**
* Ensures QoS (latency, priority)

ğŸ‘‰ Mainly active in **5G (not LTE)**

---

## 3ï¸âƒ£ PDCP (L2)

Functions:

* Header compression (ROHC)
* Ciphering (encryption)
* Integrity (for control)
* PDCP SN added

Output: **PDCP PDU**

---

## 4ï¸âƒ£ RLC (L2)

Modes:

* **AM** (acknowledged)
* **UM**
* **TM**

Functions:

* Segmentation / reassembly
* Retransmission (if AM)
* In-order delivery

Output: **RLC PDU**

---

## 5ï¸âƒ£ MAC (L2) â€” âš ï¸ Key Layer

Functions:

* Scheduling decision (RBs, slots)
* HARQ process handling
* Logical channel multiplexing
* Priority handling

MAC creates:

* **Transport Block (TB)**
* Adds MAC header + HARQ ID

---

## 6ï¸âƒ£ PHY (L1)

Functions:

* Channel coding (LDPC / Polar)
* Modulation (QPSK, 16QAM, 64QAM, 256QAM)
* Resource mapping to **timeâ€“frequency grid**
* Beamforming

Transmission channel:

* **PDSCH (Physical Downlink Shared Channel)**

---

## 7ï¸âƒ£ UE Reception

* UE demodulates â†’ decodes
* HARQ feedback sent:

  * **ACK** (success)
  * **NACK** (retransmission)

---

### âœ… DL Flow Summary

```
UPF â†’ SDAP â†’ PDCP â†’ RLC â†’ MAC â†’ PHY â†’ PDSCH â†’ UE
```

---

# ğŸ“¤ Uplink (UL) Data Flow â€” UE âœ Network

## 1ï¸âƒ£ UE Data Generation

* App generates data
* Data enters protocol stack

---

## 2ï¸âƒ£ PDCP (UE Side)

* Ciphering
* PDCP SN added
* QoS flow handling

---

## 3ï¸âƒ£ RLC

* Segmentation
* Buffering
* AM retransmissions (if enabled)

---

## 4ï¸âƒ£ MAC (UE Side)

âš ï¸ UL needs **permission (grant)**

MAC tasks:

* Buffer Status Report (**BSR**)
* Scheduling Request (**SR**)
* HARQ process selection

---

## 5ï¸âƒ£ UL Scheduling (gNB)

* UE sends **SR**
* gNB sends **UL Grant** via **PDCCH**
* Grant defines:

  * RBs
  * Slot
  * MCS
  * HARQ process

---

## 6ï¸âƒ£ PHY Transmission

* UE transmits data on:

  * **PUSCH**
* DMRS used for channel estimation

---

## 7ï¸âƒ£ gNB Reception

* Decode UL data
* Send HARQ:

  * **ACK** â†’ success
  * **NACK** â†’ retransmission

---

### âœ… UL Flow Summary

```
UE â†’ PDCP â†’ RLC â†’ MAC â†’ PHY â†’ PUSCH â†’ gNB â†’ UPF
```

---

# ğŸ”„ DL vs UL (Quick Comparison)

| Aspect          | Downlink | Uplink   |
| --------------- | -------- | -------- |
| Who schedules   | gNB      | gNB      |
| Main channel    | PDSCH    | PUSCH    |
| Control channel | PDCCH    | PDCCH    |
| HARQ feedback   | UE â†’ gNB | gNB â†’ UE |
| Grant needed    | âŒ        | âœ…        |

---

# â±ï¸ Where HARQ Fits

* MAC assigns **HARQ process ID**
* PHY decodes
* Feedback sent after **k1 slots**
* Retransmission scheduled if NACK

---

# ğŸ§  Interview One-Liners

* **Downlink**: Data flows from core â†’ gNB â†’ UE via PDSCH
* **Uplink**: UE needs UL grant before transmitting on PUSCH
* **MAC** controls scheduling and HARQ
* **PHY** maps data onto timeâ€“frequency grid

---

# ğŸ§© Simple Analogy

ğŸ“¦ **Courier System**

* DL: Warehouse â†’ Delivery boy â†’ Customer
* UL: Customer requests pickup â†’ approval â†’ pickup

---

If you want next:

* DL vs UL call flow diagram (stepwise)
* Control plane vs user plane
* MAC scheduler deep dive
* Where latency is added in DL/UL

Just tell me ğŸ‘
