#
# **Layer 2 (L2) Protocols in 5G NR**

![Image](https://techplayon.com/wp-content/uploads/2017/09/Control-Plane.png?utm_source=chatgpt.com)

![Image](https://www.keysight.com/blogs/en/inds/2020/07/23/media_11ad6ec033986f6c4f89f888c15b97e0b07351299.png?format=png\&optimize=medium\&width=750\&utm_source=chatgpt.com)

![Image](https://www.5gtechnologyworld.com/wp-content/uploads/2021/05/OpenRAN_Functional_Split_L-R.jpg?utm_source=chatgpt.com)

In **5G NR**, **Layer 2 (L2)** sits between **PHY (Layer 1)** and **Layer 3 (RRC)** and is responsible for **reliable data transfer, scheduling, security, and QoS handling**.

As standardized by **3GPP**, L2 consists of **three sub-layers**:

---

## ğŸ”¹ 1. **MAC (Medium Access Control)**

**Position:** Closest to PHY

### Main responsibilities

* **Scheduling** (UL/DL grants)
* **Multiplexing / demultiplexing** of logical channels
* **HARQ** management
* **Priority handling**
* **Buffer Status Reports (BSR)**
* **Random Access (RACH)** procedures

### Why MAC is critical

* Controls **who transmits, when, and how much**
* Directly impacts **latency and throughput**
* Central to **5G L2 scheduler design**

---

## ğŸ”¹ 2. **RLC (Radio Link Control)**

### Modes of operation

| Mode                    | Purpose                        |
| ----------------------- | ------------------------------ |
| **TM** (Transparent)    | Broadcast (e.g., paging)       |
| **UM** (Unacknowledged) | Low latency (VoNR, streaming)  |
| **AM** (Acknowledged)   | Reliable data (TCP, signaling) |

### Responsibilities

* **Segmentation & reassembly**
* **Retransmission** (AM mode)
* **In-order delivery**
* **Duplicate detection**
* **Error correction**

---

## ğŸ”¹ 3. **PDCP (Packet Data Convergence Protocol)**

### Responsibilities

* **Header compression** (ROHC)
* **Ciphering & integrity protection**
* **Sequence numbering**
* **Reordering**
* **Duplicate packet detection**
* **Support for mobility** (handover, CHO, DAPS)

### PDCP is key for

* **Security**
* **Mobility robustness**
* **User-plane & control-plane reliability**

---

## ğŸ” Data flow (simplified)

```
Application
   â†“
PDCP  â†’ Security, reordering
   â†“
RLC   â†’ Segmentation, retransmission
   â†“
MAC   â†’ Scheduling, HARQ
   â†“
PHY   â†’ Transmission over air
```

---

## ğŸ“¡ Control Plane vs User Plane in L2

| Plane             | L2 protocols     |
| ----------------- | ---------------- |
| **Control Plane** | PDCP + RLC + MAC |
| **User Plane**    | PDCP + RLC + MAC |

(Difference lies in **configuration**, not protocol presence)

---

## ğŸ§  Interview-ready one-liners

* **MAC:** *Manages scheduling, HARQ, and radio resource allocation*
* **RLC:** *Ensures reliable and ordered delivery*
* **PDCP:** *Handles security, header compression, and mobility*

---

## ğŸ§ª Real-world relevance (CU/DU)

Since you work on **5G CU/L2**, typical implementations involve:

* **PDCP in CU**
* **RLC/MAC in DU** (in split architectures)
* Tight coordination for **CHO, mobility, and latency**

---

## ğŸ” Summary table

| Sub-layer | Key focus               |
| --------- | ----------------------- |
| MAC       | Radio scheduling & HARQ |
| RLC       | Reliability & ordering  |
| PDCP      | Security & mobility     |

---

If you want next:

* L2 **functional splits (Option 2, 7.x)**
* L2 **call flow for handover / CHO**
* Scheduler deep-dive (PF, RR, QoS-aware)
* L2 debugging (Wireshark, logs, KPIs)

Just tell me ğŸ‘

==================================================================================================
Below is a **clean, interview-ready explanation** of **HARQ**, its **use-cases**,
 and **HARQ timing alignment**â€”exactly how it works in **LTE / 5G NR (L1â€“L2 interaction)**.

---

## ğŸ” What is HARQ?

**HARQ (Hybrid Automatic Repeat reQuest)** is a **fast error-recovery mechanism** 
used between **MAC (L2)** and **PHY (L1)**.

It **combines**:

* âŒ **Error detection** (CRC)
* ğŸ” **Retransmission**
* ğŸ§  **Soft combining** (Chase / IR)

ğŸ‘‰ Instead of fully discarding failed packets, 
the receiver **combines retransmissions** to improve decoding.

---

## ğŸ¯ Why HARQ is Needed (Use-case)

Wireless channels are:

* Fading
* Noisy
* Interference-prone

HARQ:

* Improves **reliability**
* Reduces **packet loss**
* Keeps **latency low** (faster than RLC retransmission)

---

## ğŸ§± Where HARQ Lives (Protocol Stack)

```
RLC  â†’ long-term reliability (slow)
MAC  â†’ HARQ (fast)
PHY  â†’ decoding & soft combining
```

ğŸ‘‰ HARQ operates at **MAC layer**, but **executed by PHY**.

---

## ğŸ”„ HARQ Working (Step-by-Step)

![Image](https://www.sharetechnote.com/html/5G/image/5G_HARQ_HowItWorks_01.png)

![Image](https://helpfiles.keysight.com/csg/n7624/Content/RT/harqlevmodlte.gif)

![Image](https://www.mohamedeladawi.com/content/images/2025/08/image-5.png)

1ï¸âƒ£ gNB transmits data with **HARQ process ID**
2ï¸âƒ£ UE decodes and checks **CRC**
3ï¸âƒ£ UE sends:

* **ACK** â†’ success
* **NACK** â†’ failure
  4ï¸âƒ£ If NACK â†’ gNB retransmits
  5ï¸âƒ£ UE **combines old + new data**
  6ï¸âƒ£ Repeat until success or max retries

---

## ğŸ§  Types of HARQ Combining

| Type                            | Description                           |
| ------------------------------- | ------------------------------------- |
| **Chase Combining**             | Retransmit same bits                  |
| **Incremental Redundancy (IR)** | Transmit new parity bits (5G default) |

---

## â±ï¸ What is HARQ Timing Alignment?

**HARQ timing alignment** means:

> **ACK/NACK and retransmissions must happen at fixed, predefined time intervals**

So both **UE and gNB know exactly when** to:

* Send feedback
* Expect retransmission
* Free HARQ buffers

---

## â° HARQ Timing Example

### LTE (Fixed)

* Data sent in **subframe n**
* ACK/NACK in **n + 4**
* Retransmission in **n + 8**

ğŸ‘‰ Predictable & rigid

---

### 5G NR (Flexible)

![Image](https://www.mohamedeladawi.com/content/images/size/w1200/2025/08/5G-UL-HARQ-Timing.png)

![Image](https://media.licdn.com/dms/image/v2/C5612AQGsWkTniE-57A/article-cover_image-shrink_600_2000/article-cover_image-shrink_600_2000/0/1589049040672?e=2147483647\&t=h-p7wK_VRHD_Ks8mksJPnr2HfkLRdwELKbge46xkOtU\&v=beta)

* Timing defined by:

  * **k1** â†’ ACK/NACK timing
  * **k2** â†’ UL scheduling timing
* Depends on:

  * Numerology
  * TDD pattern
  * Slot duration

ğŸ‘‰ Much more flexible than LTE

---

## ğŸ§® Why HARQ Timing Alignment is Critical

If timing is **misaligned**:

* ACK/NACK arrives too early/late
* Retransmission sent in wrong slot
* HARQ process buffers mismatch
* Leads to **throughput drop or call drop**

---

## ğŸ”¢ HARQ Processes

| Technology | HARQ processes |
| ---------- | -------------- |
| LTE        | 8 (DL), 8 (UL) |
| 5G NR      | Up to 16       |

ğŸ‘‰ Multiple processes allow **parallel transmissions**

---

## ğŸ¯ Interview-Ready One-Liners

* **HARQ** is a fast L2 error recovery mechanism combining retransmission and soft combining
* **HARQ timing alignment** ensures ACK/NACK and retransmissions occur at known time offsets
* **5G NR HARQ** uses flexible timing via **k1/k2** parameters
* **HARQ improves reliability with low latency compared to RLC**

---

## ğŸ§© Simple Analogy

ğŸ“¦ Courier delivery:

* ACK â†’ â€œDeliveredâ€
* NACK â†’ â€œResendâ€
* HARQ buffer â†’ â€œSaved package pieces combined laterâ€

---

If you want next:

* DL vs UL HARQ difference
* HARQ vs ARQ vs RLC
* k1/k2 explained with real slot numbers
* HARQ interview traps & common mistakes

Just say ğŸ‘

